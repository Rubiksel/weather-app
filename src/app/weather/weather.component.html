<form [formGroup]="weatherForm" (ngSubmit)="onSubmit()" class="mb-4">
  <div class="row g-3">
    <div class="col-md-4">
      <input
        type="text"
        class="form-control"
        placeholder="City"
        formControlName="city"
      />
    </div>
    <div class="col-md-4">
      <input
        type="text"
        class="form-control"
        placeholder="State (optional)"
        formControlName="state"
      />
    </div>
    <div class="col-md-4">
      <input
        type="text"
        class="form-control"
        placeholder="Country (e.g., US)"
        formControlName="country"
      />
    </div>
  </div>

  <div class="row g-3 mt-2">
    <div class="col-md-6">
      <input
        type="text"
        class="form-control"
        placeholder="Latitude (optional)"
        formControlName="lat"
      />
    </div>
    <div class="col-md-6">
      <input
        type="text"
        class="form-control"
        placeholder="Longitude (optional)"
        formControlName="lon"
      />
    </div>
  </div>

  <!-- Angular-based Language Dropdown -->
  <div class="dropdown text-end mb-4 position-relative">
    <button
      class="btn btn-outline-secondary d-flex align-items-center gap-2"
      type="button"
      (click)="showLangDropdown = !showLangDropdown"
    >
      🌐 {{ lang.toUpperCase() }}
    </button>

    <ul
      class="dropdown-menu show"
      *ngIf="showLangDropdown"
      style="display: block; position: absolute; right: 0; z-index: 1000"
    >
      <li>
        <button
          class="dropdown-item d-flex align-items-center gap-2"
          (click)="setLanguage('en')"
        >
          <img src="https://flagcdn.com/us.svg" width="20" /> English
        </button>
      </li>
      <li>
        <button
          class="dropdown-item d-flex align-items-center gap-2"
          (click)="setLanguage('fr')"
        >
          <img src="https://flagcdn.com/fr.svg" width="20" /> French
        </button>
      </li>
      <li>
        <button
          class="dropdown-item d-flex align-items-center gap-2"
          (click)="setLanguage('es')"
        >
          <img src="https://flagcdn.com/es.svg" width="20" /> Spanish
        </button>
      </li>
      <li>
        <button
          class="dropdown-item d-flex align-items-center gap-2"
          (click)="setLanguage('de')"
        >
          <img src="https://flagcdn.com/de.svg" width="20" /> German
        </button>
      </li>
    </ul>
  </div>

  <div class="mt-3">
    <button type="submit" class="btn btn-primary w-100">Search Weather</button>
  </div>
</form>

<!-- Unit Toggle -->
<div class="mb-3 text-center">
  <app-metric-toggle (unitChange)="onUnitChange($event)"></app-metric-toggle>
</div>

<!-- Days Selection -->
<div class="mb-3 text-center">
  <label class="form-label">Select Forecast Length:</label>
  <div class="btn-group" role="group">
    <button
      type="button"
      class="btn"
      [class.btn-primary]="selectedDays === 1"
      [class.btn-outline-primary]="selectedDays !== 1"
      (click)="onDaysChange(1)"
    >
      1 Day
    </button>
    <button
      type="button"
      class="btn"
      [class.btn-primary]="selectedDays === 3"
      [class.btn-outline-primary]="selectedDays !== 3"
      (click)="onDaysChange(3)"
    >
      3 Days
    </button>
    <button
      type="button"
      class="btn"
      [class.btn-primary]="selectedDays === 7"
      [class.btn-outline-primary]="selectedDays !== 7"
      (click)="onDaysChange(7)"
    >
      7 Days
    </button>
  </div>
</div>

<!-- Error Message -->
<div *ngIf="errorMessage" class="alert alert-danger text-center">
  {{ errorMessage }}
</div>

<!-- Forecast Display -->
<div *ngIf="weatherData?.daily" class="row mt-4">
  <div
    class="col-md-3 mb-3"
    *ngFor="let day of weatherData.daily.slice(0, selectedDays)"
  >
    <div class="card h-100 text-center shadow-sm">
      <div class="card-body">
        <h6 class="card-title">
          {{ day.dt * 1000 | date : "EEE, MMM d" }}
        </h6>
        <img
          [src]="
            'https://openweathermap.org/img/wn/' +
            day.weather[0].icon +
            '@2x.png'
          "
          [alt]="day.weather[0].description"
        />
        <p class="text-capitalize mb-1">
          {{ day.weather[0].description }}
        </p>
        <p class="mb-0">
          <strong>Min:</strong> {{ day.temp.min | number : "1.0-0" }}°<br />
          <strong>Max:</strong> {{ day.temp.max | number : "1.0-0" }}°
        </p>
      </div>
    </div>
  </div>
</div>
